"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUpdates = void 0;
const getUpdates = (app, telegramServer) => {
    app.post('/getUpdates', (req, res) => {
        const botToken = req.body.token;
        const messages = telegramServer.storage.botMessages.filter((update) => (update.botToken === botToken
            && String(update.message.chat_id) === String(req.body.chatId)
            && !update.isRead));
        messages.forEach((update) => {
            update.isRead = true;
        });
        const data = { ok: true, result: messages };
        res.sendResult(data);
    });
};
exports.getUpdates = getUpdates;
